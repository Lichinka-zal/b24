# b24
Bitrix 24 connector for MS Power BI. Получает информацию из облачного и коробочного битрикс.

## Описание параметров

Параметр | Описание
---------|--------
chain | пакет запросов к функции batch https://dev.1c-bitrix.ru/rest_help/general/batch.php
connection | строка подключения к вебхуку (см. ниже, где её взять)
id | список идентификаторов (виде списка или текста) для автоматического создания пакета запросов типа get

## Инструкция по работе

Тестировал только на запросах get и list

Справочник по API Битрикс 24 https://dev.1c-bitrix.ru/rest_help/index.php

У пакетных запросов немного особенный синтаксис: настройка фильтров, идентификаторов и списка возвращаемых полей происходит в GET-параметрах

### Примеры вызовов
* b24("department.get") // список подразделений
* b24("crm.deal.list?filter[>DATE_CREATE]=2019-03-15T00:00:00&filter[<DATE_CREATE]=2019-03-18T00:00:00") // список сделок в промежутке дат с 15.03.2019 по 18.03.2019
* b24(Text.Format("crm.lead.list?filter[>DATE_CREATE]=#[from]&filter[<DATE_CREATE]=#[to]&filter[SOURCE_ID]=OTHER&select[]=ID&select[]=TITLE", [from = DateTime.ToText(begin,"yyyy-MM-ddT00:00:00"), to = DateTime.ToText(today,"yyyy-MM-ddT00:00:00")])) // список лидов в промежутке дат, созданных из источника OTHER, с возвратом только полей ID и TITLE
* b24("crm.dealcategory.stage.list?id=5") // список этапов 5-й воронки
* b24("crm.deal.get?id=",null,{1529,2227}) // пакетное получение сделок с идентификаторами 1529 и 2227
* b24("voximplant.statistic.get",null,false) // возвращает список из первых 50 значений

## Как создать строку подключения
Убедитесь, что у вас достаточно прав в Битрикс 24.
1. Залогиниться в Б24
2. Пройти в "Приложения" > "Вебхуки" https://prnt.sc/q52kpf
3. Нажать "Добавить вебхук" > "Входящий вебхук" http://prntscr.com/q52n3i
4. Придумать название, выбрать права доступа (их можно потом отредактировать) http://prntscr.com/q52o0n
5. Сохранить и скопировать строку подключения http://prntscr.com/q52r32 . Указывайте ее в connection

Параметры подключения можно задать в теле коннектора, чтобы не указывать каждый раз. Смотрите комментарии в коде

## Использование параметра id
Не указывайте параметр, если не понимаете, что делаете и зачем.

### Сценарий 1. Перебор идентификаторов
1. Параметры chain должны заканчиваться на "=", например, так "crm.deal.list?filter[LEAD_ID]="
2. После "=" будут подставлены идентификаторы, перечисленные в списке id. 

Пример: b24("crm.deal.get?id=",null,{1529,2227})

Важно:
 * Можно использовать list или text с любым из разделителей: ".,; ". 
 * Сами идентификаторы должны быть написаны цифрами 

### Сценарий 2. Получение первой группы значений
1. Укажите chain, который хотите проанализировать, например, "voximplant.statistic.get"
2. Укажите id = false

Что произойдет?
* вернет не больше 50 строк, а не весь список
* в metadata будет записано общее кол-во найденных строк в списке 

Пример: Value.Metadata(b24("voximplant.statistic.get",null,false))[result_total]


